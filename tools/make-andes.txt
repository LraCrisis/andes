# Choose DOS style text files in cygwin and restart windows
# install make in cygwin by running "setup"

# cygwin git, by default, only works if the filesystem is mounted
#   binary.  (Might get it to work with linefeed conversion and textmode
#   mount, but haven't tried this.)  Instead, use msysgit install
#   and with the bash shell provided with git, checkout Andes2:
   cd /c/cygwin/home/Andministrator
   git clone ssh://bvds@andestutor.org/home/bvds/Andes2.git Andes2

# Microsoft visual studio install version 6.0 from 1998
#   vc32/setup.exe
#  modifications:  install MFC source code and 
#                  MFC source browser and
#                 run environment variables.
# Documentation c++ sdk, 
# optional:  Install latest service pack 
#    (6.0 for visual studio 6) from    
#   support.microsoft.com/kb/194022
#    run extractor
#    save extracted files into new folder, run setupsp6

# Can also use MFC IDE, choose FBD/Fbd.dsw and choose 
# "Win32 OLI Release", build "Fbd-tcp.exe" need all three versions ...).
# Then move executables with "mv -v FBD/*_Release/Fbd-*.exe ."
make workbench

# Can also user MFC ide, show all files, choose Algebra/src/Solver.dsw,
# choose "Win 32 Debug", and build
# Then move executables with "mv -v Algebra/src/Debug/Solver.dll ."
make solver
make installer

# needs Franz lisp, modify path in makedll.cl and makehelp80.cl
make helpsys 
# need to exit lisp by hand.
# seems the tcp version is hanging

# download winzip standard and command line add-on
# to make distribution for use in oli course
tools/MakeDist.sh -oli
#

#-----------------------------------------------------------
#
#           setup oli accounts
#
# Apply for an andrew account
# The next step is to make sure you have one regular OLI account and one 
# web-iso account on both Odin and QA.
#
# So on qa, https://oli-qa.andrew.cmu.edu create an account using the 
# "Carnegie Mellon Users Log-in Here" link and your andrew id.
#
# On Odin, http://odin.web.cmu.edu create two accounts. One account using 
# the "Carnegie Mellon Users Log-in Here" link and your andrew id. The 
# second account using the main "Need an account?" link.  (To login,
# use "Non-Carnegie Mellon users".)
#
# Your account names can be the same on each server.
#
#  --------------------------------------------------------------
#
#                       Put course into OLI cvs  
#   Now, this step is done on the Windows machine, but it could
#   be just as well done elsewhere if the binaries are all put into the Andes2
#   repository.
#
mkdir -p oli-course
cd oli-course
# replace with right user name and version, see tools/Andes-OLI.html
# andersw pass: andersoli
cvs -d :ext:bvds@oli-cvs.andrew.cmu.edu:/oli/cvs/content/lrdc/intro_physics co -P -d intro_physics-2.0 intro_physics-1.0 
#
# edit oli-course/intro-physics-*/content/package.xml & update version number
# Likewise for organizations/*/organization.xml files
#
cd ..
make Statements
cp Problems/*.aps oli-course/intro_physics-*/
cd oli-course/intro_physics-*/
#  remove irrelevant *.aps files by hand. 
#  run the following with some unique identifier for output file
perl  ../../tools/aps2xml.pl *.aps > july-28-output.txt
#  use different output file for each run, so below grep will work.
#  It will complain about any problems that are included in aps files,
#     but not having feature Andes2.
grep Add *-output.txt 
#  If the grep reports any new files,  add them to cvs. 
#  Next copy over content files:
cp -p -u ../../andes_installer.exe content/webcontent
cp -p -u ../../Videos/*.* content/webcontent
#  Non-problem set specific content must be updated by hand (videos, etc). 
cvs commit -m "latest updates, blah blah"

#
#         Now switch to working on OLI machine
#

ssh bvds@odin.web.cmu.edu
# andersw pass:  andersoli
echo "setenv CVS_RSH ssh" >> ~/.login  #on first login
cd /oli/private/bvds

# on first login
cvs -d :ext:bvds@oli-cvs.andrew.cmu.edu:/oli/cvs/content/lrdc/intro_physics co -d intro_physics-2.0 intro_physics-1.0

cd intro_physics-*/
cvs update -dP
 cp log4j.properties.sample log4j.properties
ant

./tools/oli/deploy.sh

# pipe in account name and password.
#Account ID: andersw   Password: andersoli

exit

#---------------------------------------------------------------------------
#
#              test course using web browser
#
# Browser odin.web.cmu.edu
# Login via Andrew, then login using "Non-Carnegie Mellon users"
# "Create a new course"  this is what an instructor will do.
# Create a new course
# simple mode:  choose course
# (in principle, should make 3 different courses and test all combinations)
#  choose Full course
# "andes-20" is admit code (no password) or physics-test
# test course as student (bvds-test)
#
# need to use internet explorer to install certificate for the QA server.
# in IE, go to https://www.cmu.edu/computing/software/all/certs/download.html
#  Can otherwise use firefox.   This is not an issue on the production server.
#
# See bug #1487.